<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Cookie</title>
    <style>
      .modal {
        display: block;
        width: 600px;
        max-width: 100%;
        height: 400px;
        max-height: 100%;
        position: fixed;
        z-index: 100;
        left: 50%;
        top: 50%;
        border-radius: 10px;
        transform: translate(-50%, -50%);
        background: white;
        box-shadow: 0 0 60px 10px rgba(0, 0, 0, 0.9);
      }

      .modal_closed {
        display: none;
      }

      .modal__header {
        border-bottom: 1px gray solid;
        padding: 10px 15px;
        margin-bottom: 15px;
      }

      .modal__close {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAEFCu8CAAAABGdBTUEAALGPC/xhBQAAAqpJREFUSA2tljtyFEEMhsdgHJpb2NyAxwkgcQHGHGE3Bs4B8RICV6G4ARSERH4QGaog4vF/qv7HWu3MzrqMqjR69C9puls9PV13QU9Rr13Y3Vfpf7GPxLdRROGw0hs43vHYFuM9wYAMOcbYaQ47u7fJgRMGFMkwIgyHyIDesNMgAD3dkvZDvGWPlSVUG4wxBu43h0HIGT4UO7Hv2EeoB1wCQPhYzi/i12JHSA26acWpLV96IMtDGQZU+TEDrT9qAb8lD8RnzXbwC9mL5vsjGbSvpwGnzWfB+5s8F7C/cLLSDrS8y0Ci+gbguutiBzxLYCoQkMm4D0NOD47JwVUl0Vz8U5wD38veFa8ldptDw9xpfhZvkj4JkStlnT1eoXxmMrjqHKUlYlMBsclsdg5gZWkKmgP/Q3EQi2Fgc/WNe2yH5IOKowscWDslxXV0lXF7DNiwzMEOpLLHkTHX7ECv3XKvBIH5Ll7KlOfEmIm3yAWeMEDf2Ylt+iYlv/Zz2cbR39FKdmBDeU4O5jMB7jMA0yspDp6SjunlJsE3enRROAGchFyVkzIruEmTT91cTLJ61GpyMGApfinioGwy3VxwSCcHudbS/yhUi5NzhXbl4QbJ4EVB0T65nYzF59ZyiFvMGFqNGkE0a25yg/KHuUFDkJxjB9dCAdAjHwbno0YcDP4s7KySt/dfh9RJ4gWGVsF54wgP3VMGWDKbenfl6nxYwBg/JuNjw8UwBsA/tEdyr9DU7MgVn8V9Kflj7OL8kY0tJ8nH9g9//mg7HzX2xEFzPT1g6V+pBglRZzE2+3y9ON8sJ0LnD8eXHCAus4X4QMyFt26PGAMDliPhi5A85OwvROlLtCOLdfZbXVWSi5wb0WOh+Nm7bFFiiL0S8btDc/HL80Z83hgdH2NgJukfa8ehuEonW4wAAAAASUVORK5CYII=");
        overflow: hidden;
        text-indent: -999em;
        text-decoration: none;
      }

      .modal__close:hover {
        background-color: #dc3545;
        text-decoration: none;
      }

      .modal__content {
        padding: 10px 15px;
        min-height: 200px;
      }

      .form-field {
        padding: 0 0 10px;
      }

      /* .form-field label {
      } */

      .form-field input {
        border: 1px gray solid;
        border-radius: 5px;
        padding: 8px 12px;
        margin: 0 10px;
        font-size: 14px;
        font-family: "Exo 2", sans-serif;
      }

      .form-field .input__default {
        width: 380px;
      }

      .form-field .input__date-birth {
        width: 100px;
        text-align: center;
      }

      .modal__footer {
        border-top: 1px gray solid;
        padding: 15px;
        margin-top: 15px;
        text-align: right;
      }

      .modal__footer button {
        border: 1px gray solid;
        border-radius: 5px;
        padding: 8px 12px;
        margin: 0 10px;
        font-size: 14px;
        font-family: "Exo 2", sans-serif;
      }

      .modal__footer .modal__cancel {
        background-color: #dc3545;
        border-color: #dc3545;
        color: #fff;
      }

      .modal__footer .modal__cancel:hover {
        background-color: #c82333;
        border-color: #bd2130;
      }

      .modal__footer .modal__cancel:active {
        background-color: #bd2130;
        border-color: #b21f2d;
      }

      .modal__footer .modal__save {
        background-color: #28a745;
        border-color: #28a745;
        color: #fff;
      }

      .modal__footer .modal__save:hover {
        background-color: #218838;
        border-color: #1e7e34;
      }

      .modal__footer .modal__save:active {
        background-color: #1e7e34;
        border-color: #1c7430;
      }
    </style>
  </head>
  <body>
    <div class="modal" id="myModal">
      <header class="modal__header">
        <a
          href="#"
          id="close"
          class="modal__close"
          title="Закрыть модальное окно"
          >Закрыть</a
        >
        <h2>Введите данные</h2>
      </header>

      <main class="modal__content">
        <div class="form-field">
          <label for="name">Ваше имя:</label>
          <input class="input__default" type="text" id="name" name="name" />
        </div>
        <div class="form-field">
          <label for="birthday">Ваша дата рождения:(дд.мм.гггг)</label>
          <!-- prettier-ignore -->
          <input class="input__default" type="text" id="birthday" name="birthday" />
        </div>
      </main>

      <footer class="modal__footer">
        <button class="modal__cancel" title="Отмена" id="cancel">
          Отмена
        </button>
        <button id="save" class="modal__save" title="Сохранить">
          Сохранить данные
        </button>
      </footer>
    </div>
    <div id="birthdayText"></div>
    <script>
      let date_regex = /^(0[1-9]|1\d|2\d|3[01])\.(0[1-9]|1[0-2])\.(18|19|20)\d{2}$/;
      let name = document.getElementById("name");
      let birthday = document.getElementById("birthday");
      let modal = document.getElementById("myModal");
      let birthdayText = document.getElementById("birthdayText");
      let saveBut = document.getElementById("save");
      let cancel = document.getElementById("cancel");
      let close = document.getElementById("close");
      saveBut.addEventListener("click", function(e) {
          e.preventDefault();
          save();
      });
      cancel.addEventListener('click', function() {
          modal.classList.add('modal_closed');
      })
      close.addEventListener('click', function() {
          modal.classList.add('modal_closed');
      })
      function save() {
        if (name.value != "" && name.value != null && name.value != undefined) {
          if (date_regex.test(birthday.value)) {
            setCookie("age", birthday.value);
            setCookie("name", name.value);
            setInterval(out, 1000);
          } else {
            birthday.style.borderColor = red;
          }
        } else {
          name.style.borderColor = red;
        }
      }
      function setCookie(name, value, options) {
        options = options || {};
        let expires = options.expires;
        if (typeof expires == "number" && expires) {
          let d = new Date();
          d.setTime(d.getTime() + expires * 1000);
          expires = options.expires = d;
        }
        if (expires && expires.toUTCString) {
          options.expires = expires.toUTCString();
        }
        value = encodeURIComponent(value);
        let updatedCookie = name + "=" + value;
        for (let propName in options) {
          updatedCookie += "; " + propName;
          let propValue = options[propName];
          if (propValue !== true) {
            updatedCookie += "=" + propValue;
          }
        }
        document.cookie = updatedCookie;
      }
      function getCookie(name) {
        let matches = document.cookie.match(
          new RegExp(
            "(?:^|; )" +
              name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, "\\$1") +
              "=([^;]*)"
          )
        );
        return matches ? decodeURIComponent(matches[1]) : undefined;
      }
      function deleteCookie(name) {
        setCookie(name, "", {
          expires: -1
        });
      }
      function reverseDate(date) {
        let arr = date
          .split(".")
          .reverse()
          .join(", ");
        return arr;
      }
      function out() {
        let today = new Date();
        let currentYear = today.getFullYear();
        let bornDate = new Date(reverseDate(getCookie("age")));
        let bd_Month = bornDate.getMonth();
        let bd_Day = bornDate.getDate();
        let bd_Millisecond = bornDate.getTime();
        let endDate = new Date(currentYear, bd_Month, bd_Day);
        if (endDate - today < 0) {
          endDate = new Date(currentYear + 1, bd_Month, bd_Day);
        }
        today = Math.floor((endDate - today) / 1000);
        let tsec = today % 60;
        today = Math.floor(today / 60);
        if (tsec < 10) tsec = "0" + tsec;
        let tmin = today % 60;
        today = Math.floor(today / 60);
        if (tmin < 10) tmin = "0" + tmin;
        let thour = today % 24;
        today = Math.floor(today / 24);
        let congr = "";
        if (
          endDate.getDate() == new Date().getDate() &&
          endDate.getMonth() == new Date().getMonth()
        ) {
          congr =
            `Здравствуйте, ${getCookie("name")}!` +
            "<br>" +
            "Поздравляем! Сегодня Ваш День Рождения!";
        }
        let dayText;
        let arr_dayText = (today + "").split("");
        if (arr_dayText[arr_dayText.length - 1] == 1) {
          dayText = "день";
        } else if (
          arr_dayText[arr_dayText.length - 1] == 2 ||
          arr_dayText[arr_dayText.length - 1] == 3 ||
          arr_dayText[arr_dayText.length - 1] == 4
        ) {
          dayText = "дня";
        } else {
          dayText = "дней";
        }
        let hourText;
        let arr_hourText = (thour + "").split("");
        if (arr_hourText[arr_hourText.length - 1] == 1) {
          hourText = "час";
        } else if (
          arr_hourText[arr_hourText.length - 1] == 2 ||
          arr_hourText[arr_hourText.length - 1] == 3 ||
          arr_hourText[arr_hourText.length - 1] == 4
        ) {
          hourText = "часа";
        } else {
          hourText = "часов";
        }
        let minText;
        let arr_minText = (tmin + "").split("");
        if (arr_minText[arr_minText.length - 1] == 1) {
          minText = "минута";
        } else if (
          arr_minText[arr_minText.length - 1] == 2 ||
          arr_minText[arr_minText.length - 1] == 3 ||
          arr_minText[arr_minText.length - 1] == 4
        ) {
          minText = "минуты";
        } else {
          minText = "минут";
        }
        let secText;
        let arr_secText = (tsec + "").split("");
        if (arr_secText[arr_secText.length - 1] == 1) {
          secText = "секунда";
        } else if (
          arr_secText[arr_secText.length - 1] == 2 ||
          arr_secText[arr_secText.length - 1] == 3 ||
          arr_secText[arr_secText.length - 1] == 4
        ) {
          secText = "секунды";
        } else {
          secText = "секунд";
        }

        let timestr =
          `Здравствуйте, ${getCookie("name")}!` +
          "<br>" +
          `До Вашего Дня Рождения:` +
          "<br>" +
          `${today} ${dayText} ${thour} ${hourText} ${tmin} ${minText} ${tsec} ${secText}`;
        if (congr) {
          timestr =
            congr +
            "<br>" +
            "До следующего:" +
            "<br>" +
            `${today} ${dayText} ${thour} ${hourText} ${tmin} ${minText} ${tsec} ${secText}`;
        }
        birthdayText.innerHTML = timestr;
      }
    </script>
  </body>
</html>
